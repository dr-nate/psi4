set(LIBDERIV_CONFIG_PATH ${CMAKE_CURRENT_LIST_DIR})
find_library(LIBDERIV_LIBRARY NAMES deriv PATHS ${LIBDERIV_CONFIG_PATH}/lib 
             NO_DEFAULT_PATH)
find_path(LIBDERIV_INCLUDE_DIR NAMES libderiv.h 
          PATHS ${LIBDERIV_CONFIG_PATH}/include NO_DEFAULT_PATH)

file(READ ${LIBDERIV_INCLUDE_DIR}/libderiv.h contents)
string(REGEX MATCH "define LIBDERIV_MAX_AM1 (.|..)" DA_LINE ${contents})
set(LIBINT_MAX_AM ${CMAKE_MATCH_1})
foreach(_comp ${LIBDERIV_FIND_COMPONENTS})
   if(${_comp} GREATER ${LIBINT_MAX_AM})
      set(LIBDERIV_FOUND FALSE)
      message(STATUS 
       "Found version of libderiv does not support the requested angular momentum"
      )
   endif()
endforeach()

find_package(libint REQUIRED COMPONENTS ${LIBINT_OPT_AM})

add_library(deriv INTERFACE)
set(LIBDERIV_INCLUDE_DIRS ${LIBDERIV_INCLUDE_DIR} ${LIBINT_INCLUDE_DIR})
set(LIBDERIV_LIBRARIES ${LIBDERIV_LIBRARY} ${LIBINT_LIBRARIES})
target_include_directories(deriv INTERFACE ${LIBDERIV_INCLUDE_DIRS})
target_link_libraries(deriv INTERFACE ${LIBDERIV_LIBRARIES})
set(LIBDERIV_FOUND TRUE)




